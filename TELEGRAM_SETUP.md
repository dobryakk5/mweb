# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üöÄ **–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

### **‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- –¢–∞–±–ª–∏—Ü–∞ `telegram_users` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram
- –¢–∞–±–ª–∏—Ü–∞ `sessions` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

### **‚úÖ API endpoints**
- `POST /api/auth/telegram` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- `POST /api/auth/logout` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `GET /api/auth/me` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### **‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `TelegramLogin` –≤ –ª–µ–≤–æ–º sidebar
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Å—Å–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ localStorage

## üîß **–ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**

### **–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ Telegram**
1. –ù–∞–ø–∏—Å–∞—Ç—å @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –ü—Ä–∏–¥—É–º–∞—Ç—å –∏–º—è –¥–ª—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "My App Bot")
4. –ü—Ä–∏–¥—É–º–∞—Ç—å username (–Ω–∞–ø—Ä–∏–º–µ—Ä: "myapp_bot")
5. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –≤–∏–¥–∞: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`

### **–®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
```bash
cd packages/db
pnpm db:create-telegram
```

### **–®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª—ã**

#### **–í packages/db/.env:**
```env
DATABASE_URL="postgresql://mwww:ploked@217.114.15.233:5432/realty?search_path=users"
BOT_TOKEN="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
```

#### **–í services/api/.env:**
```env
DATABASE_URL="postgresql://mwww:ploked@217.114.15.233:5432/realty?search_path=users"
BOT_TOKEN="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
```

### **–®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç TelegramLogin**

–í —Ñ–∞–π–ª–µ `packages/ui/src/components/telegram-login.tsx` –∑–∞–º–µ–Ω–∏—Ç—å:
```tsx
data-telegram-login="YOUR_BOT_NAME"
```
–ù–∞ –≤–∞—à username –±–æ—Ç–∞:
```tsx
data-telegram-login="myapp_bot"
```

### **–®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—ã**
```bash
# –í –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd services/api && pnpm dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd apps/web && pnpm dev
```

## üéØ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### **1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É Telegram –≤ sidebar
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Telegram Login Widget
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–µ—Å—Å–∏—è
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

### **2. –°–µ—Å—Å–∏–∏**
- –°–µ—Å—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è 30 –¥–Ω–µ–π
- –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å

### **3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –ö–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
- –¢–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å–ª—É—á–∞–π–Ω–æ
- –°–µ—Å—Å–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞—é—Ç

## üîí **–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

### **‚ö†Ô∏è –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
1. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å hash –æ—Ç Telegram** - —Å–µ–π—á–∞—Å –ø—Ä–æ–ø—É—â–µ–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS** - –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ API** - –¥–æ–±–∞–≤–∏—Ç—å rate limiting
4. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### **üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ hash (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞):**
```typescript
import crypto from 'crypto'

function verifyTelegramHash(data: any, botToken: string): boolean {
  const { hash, ...dataToCheck } = data
  const dataCheckString = Object.keys(dataToCheck)
    .sort()
    .map(key => `${key}=${dataToCheck[key]}`)
    .join('\n')
  
  const secretKey = crypto.createHash('sha256')
    .update(botToken)
    .digest()
  
  const calculatedHash = crypto.createHmac('sha256', secretKey)
    .update(dataCheckString)
    .digest('hex')
  
  return calculatedHash === hash
}
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:13000
2. –í –ª–µ–≤–æ–º sidebar –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ Telegram
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–µ - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è Telegram Login Widget
4. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram
5. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤–∞—à–∞ –∞–≤–∞—Ç–∞—Ä–∫–∞ –∏ –∫–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏"

## üêõ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:**

### **–ü—Ä–æ–±–ª–µ–º–∞: "Bot not found"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å username –±–æ—Ç–∞ –≤ `data-telegram-login`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç —Å–æ–∑–¥–∞–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω

### **–ü—Ä–æ–±–ª–µ–º–∞: "Database error"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î

### **–ü—Ä–æ–±–ª–µ–º–∞: "Widget not loading"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç Telegram –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

## üéâ **–ì–æ—Ç–æ–≤–æ!**

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É –≤–∞—Å –±—É–¥–µ—Ç:
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ tg_user_id
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –≤—Ö–æ–¥–∏—Ç—å –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º —á–µ—Ä–µ–∑ Telegram! üöÄ
